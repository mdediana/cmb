#!/bin/bash

in=(cluster walltime nodes +after_min\|when)
[[ $# -ne ${#in[@]} ]] && echo "Usage: $(basename $0) ${in[@]}" && exit 1

set -ue
source $CMB_HOME/env.sh

cluster=$1
walltime=$2
nodes=$3
[[ $4 == +* ]] && when=$(date -d "$3 min" +"%Y-%m-%d %H:%M:%S") || when=$4

rm blacklist.conf; touch blacklist.conf

oarsub -t deploy -t allow_classic_ssh -l slash_22=2+{"cluster='$cluster'"}nodes=$nodes,walltime=$walltime -r "$when"
echo "Crontab time: $(TZ="America/Sao_Paulo" date -d "$when GMT+2" +"%M %H %d %m *")"

exit 0
